/*
 * mod_autoindex v1.3.1
 * (c) hex7c0 http://supergiovane.tk/#/mod_autoindex
 * Licensed under GPLv3
 */
"use strict";function multiple(a,b){var c="";if(a>b)return c;for(var d=0;b-a>d;d++)c+=" ";return c}function pad(a){var b=Math.abs(Math.floor(a));return(10>b?"0":"")+b}function wrapper(a){function b(b,c,d){return a.static(b,c,d)}function c(b,c,d){var e,f=c;if(d.isDirectory()?(e="-",f+="/"):e=String(d.size),b[f]=Object.create(null),a.date){var g=new Date(d.mtime),h=pad(g.getDate())+"-"+month[g.getMonth()]+"-"+g.getFullYear();h+=" "+pad(g.getHours())+":"+pad(g.getMinutes()),b[f].date=h}return a.size&&(b[f].size=e),b}function d(b,c,d,e){var f,g,h=b,i=c,j=d;if(e.isDirectory()?(g="-",j+="/"):g=String(e.size),f='<a href="'+j+'">'+j+"</a>",f+=multiple(j.length,50),a.date){var k=new Date(e.mtime);f+=pad(k.getDate())+"-"+month[k.getMonth()]+"-"+k.getFullYear(),f+=" "+pad(k.getHours())+":"+pad(k.getMinutes()),f+=multiple(g.length,20)}return a.size&&(f+=g),f+="\n",a.priority?"-"==g?h+=f:i+=f:h+=f,[h,i]}return a.sync?function(e,f,g){if(a.strictMethod&&"GET"!=e.method&&"HEAD"!=e.method)return b(e,f,g);var h=parse(e).pathname,i=a.root+h,j=fs.statSync(i);if(j){if(!j.isDirectory())return b(e,f,g);var k;a.json?k=Object.create(null):(k=header,k=k.replace(/{{path}}/g,h),"/"!=h&&(k+='<a href="../">../</a>\n'));var l=fs.readdirSync(i);if(l){var m="";return l.forEach(function(b){if(!(a.exclude&&a.exclude.test(b)||a.dotfiles&&"."==b[0])){var e=fs.statSync(i+"/"+b);if(e)if(a.json)k=c(k,b,e);else{var f=d(k,m,b,e);k=f[0],m=f[1]}}}),a.json?f.send(k):(k+=m,f.send(k+footer))}}return b(e,f,g)}:function(e,f,g){if(a.strictMethod&&"GET"!=e.method&&"HEAD"!=e.method)return b(e,f,g);var h=parse(e).pathname,i=a.root+h;fs.stat(i,function(j,k){if(j)return b(e,f,g);if(!k.isDirectory())return b(e,f,g);var l;a.json?l=Object.create(null):(l=header,l=l.replace(/{{path}}/g,h),"/"!=h&&(l+='<a href="../">../</a>\n')),fs.readdir(i,function(h,j){if(h)return b(e,f,g);var k="",m=j.length;j.forEach(function(h){if(a.exclude&&a.exclude.test(h)){if(1==m--)return a.json?f.send(l):(l+=k,f.send(l+footer))}else if(a.dotfiles&&"."==h[0]){if(1==m--)return a.json?f.send(l):(l+=k,f.send(l+footer))}else fs.stat(i+"/"+h,function(i,j){if(i)return b(e,f,g);if(a.json)l=c(l,h,j);else{var n=d(l,k,h,j);l=n[0],k=n[1]}return 1==m--?a.json?f.send(l):(l+=k,f.send(l+footer)):void 0})})})})}}try{var fs=require("fs"),resolve=require("path").resolve,parse=require("parseurl"),serve=require("serve-static")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}var header='<html>\n<head><title>Index of {{path}}</title></head>\n<body bgcolor="white">\n<h1>Index of {{path}}</h1><hr><pre>\n',footer="</pre><hr></body>\n</html>\n",month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];module.exports=function(a,b){if(!a)throw new TypeError("root path required");if(!fs.existsSync(a))throw new Error("path not exists");if(!fs.statSync(a).isDirectory())throw new Error("path is not a directory");var c=resolve(a);"/"==a[a.length-1]&&(c=a.substr(0,a.length-1));var b=b||Object.create(null),d={root:c,exclude:b.exclude||!1,dotfiles:0==b.dotfiles?!1:!0,date:0==b.date?!1:!0,size:0==b.size?!1:!0,priority:0==b.priority?!1:!0,strictMethod:Boolean(b.strictMethod),sync:Boolean(b.sync),json:Boolean(b.json),"static":0==b.static?function(a,b,c){return c()}:serve(c,b.static)};return wrapper(d)};
