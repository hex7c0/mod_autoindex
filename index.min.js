"use strict";function multiple(a,b){var c="";if(a>b)return c;for(var d=0,e=b-a;e>d;d++)c+=" ";return c}function error(a){return new Error(isNaN(a)===!1?STATUS[a]:"ENAMETOOLONG"===a.code?STATUS[414]:STATUS[404])}function pad(a){var b=Math.abs(Math.floor(a));return(10>b?"0":"")+b}function wrapper(a){function b(b,c,d){return a.static(b,c,d)}function c(b,c,d,e,g){a.json===!0?(b.send(c),f.body=c):(c+=d+footer,b.send(c),f.body=c),a.cache===!0&&(f.path=e,f.mtime=g.mtime.getTime())}function d(b,c,d,e){var f,g=d;if(e.isDirectory()===!0?(f="-",g+="/"):f=String(e.size),b[g]=Object.create(null),a.date===!0){var h=new Date(e.mtime),i=pad(h.getDate())+"-"+month[h.getMonth()]+"-"+h.getFullYear();i+=" "+pad(h.getHours())+":"+pad(h.getMinutes()),b[g].mtime=i}return a.size===!0&&(b[g].size=f),[b,null]}function e(b,c,d,e){var f,g,h=b,i=c,j=d;if(e.isDirectory()===!0?(g="-",j+="/"):g=String(e.size),f='<a href="'+j+'">'+j+"</a>",f+=multiple(j.length,50),a.date===!0){var k=new Date(e.mtime);f+=pad(k.getDate())+"-"+month[k.getMonth()]+"-"+k.getFullYear(),f+=" "+pad(k.getHours())+":"+pad(k.getMinutes()),f+=multiple(g.length,20)}return a.size===!0&&(f+=g),f+="\n",a.priority===!0?"-"===g?h+=f:i+=f:h+=f,[h,i]}var f=Object.create(null),g=e;return a.json===!0&&(g=d),a.sync===!0?function(d,e,h){if(a.strictMethod===!0&&"GET"!==d.method&&"HEAD"!==d.method)return h(error(404));var i=decodeURIComponent(parse(d).pathname).replace(/\/{2,}/,"/"),j=normalize(join(a.root,i));if(~j.indexOf("\x00"))return h(error(400));if(j<=a.root)return h(error(403));var k=fs.statSync(j);if(void 0!==k){if(void 0!==f.mtime&&f.mtime===k.mtime.getTime()&&f.path===j)return e.send(f.body);if(k.isDirectory()===!1)return b(d,e,h);var l;a.json===!0?l=Object.create(null):(l=header,l=l.replace(/{{path}}/g,i),"/"!=i&&(l+='<a href="../">../</a>\n'));var m=fs.readdirSync(j);if(void 0!==m){for(var n="",o=0,p=m.length;p>o;o++){var q=m[o];if(!(a.exclude!==!1&&a.exclude.test(q)||a.dotfiles===!0&&"."===q[0])){var r=fs.statSync(j+PATH.sep+q);if(void 0!==r){var s=g(l,n,q,r);l=s[0],n=s[1]}}}return c(e,l,n,j,k)}}return b(d,e,h)}:function(d,e,h){if(a.strictMethod===!0&&"GET"!==d.method&&"HEAD"!==d.method)return h(error(404));var i=decodeURIComponent(parse(d).pathname).replace(/\/{2,}/,"/"),j=normalize(join(a.root,i));return~j.indexOf("\x00")?h(error(400)):j<=a.root?h(error(403)):void fs.stat(j,function(k,l){if(null!==k)return h(error(k));if(f.mtime&&f.mtime===l.mtime.getTime()&&f.path===j)return e.send(f.body);if(l.isDirectory()===!1)return b(d,e,h);var m;a.json===!0?m=Object.create(null):(m=header,m=m.replace(/{{path}}/g,i),"/"!=i&&(m+='<a href="../">../</a>\n')),fs.readdir(j,function(b,d){if(null!==b)return h(error(b));for(var f="",i=d.length-1,k=0,n=d.length;n>k;k++)!function(b){return a.exclude!==!1&&a.exclude.test(b)?0===i?c(e,m,f,j,l):void i--:a.dotfiles===!0&&"."===b[0]?0===i?c(e,m,f,j,l):void i--:void fs.stat(j+PATH.sep+b,function(a,d){if(null!==a)return h(error(a));var k=g(m,f,b,d);return m=k[0],f=k[1],0===i?c(e,m,f,j,l):void i--})}(d[k])})})}}function index(a,b){if(!a)throw new TypeError("root path required");var c=resolve(a);if("/"==c[c.length-1]&&(c=c.substr(0,c.length-1)),!fs.existsSync(a))throw new Error("path not exists");if(!fs.statSync(c).isDirectory())throw new Error("path is not a directory");var d=b||Object.create(null),e={root:c,exclude:d.exclude||!1,dotfiles:d.dotfiles===!1?!1:!0,date:d.date===!1?!1:!0,size:d.size===!1?!1:!0,priority:d.priority===!1?!1:!0,cache:d.cache===!1?!1:!0,strictMethod:Boolean(d.strictMethod),sync:Boolean(d.sync),json:Boolean(d.json),"static":d.static===!1?function(a,b,c){return c()}:serve(c,d.static)};return wrapper(e)}try{var STATUS=require("http").STATUS_CODES,PATH=require("path"),fs=require("fs"),normalize=PATH.normalize,resolve=PATH.resolve,join=PATH.join,parse=require("parseurl"),serve=require("serve-static")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}var header='<html>\n<head><title>Index of {{path}}</title></head>\n<body bgcolor="white">\n<h1>Index of {{path}}</h1><hr><pre>\n',footer="</pre><hr></body>\n</html>\n",month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];module.exports=index;
