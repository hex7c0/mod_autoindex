/*
 * mod_autoindex v1.1.0
 * (c) hex7c0 http://supergiovane.tk/#/mod_autoindex
 * Licensed under GPLv3
 */
"use strict";function multiple(a,b){var c="";if(a>b)return c;for(var d=0;b-a>d;d++)c+=" ";return c}function pad(a){var b=Math.abs(Math.floor(a));return(10>b?"0":"")+b}function wrapper(a){var b='<html>\n<head><title>Index of {{path}}</title></head>\n<body bgcolor="white">\n<h1>Index of {{path}}</h1><hr><pre>\n',c="</pre><hr></body>\n</html>\n",d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return function(e,f,g){var h=url(e.originalUrl||e.url).pathname,i=a.root+h;fs.stat(i,function(e,j){if(e)return g();if(!j.isDirectory())return g();var k=b;k=k.replace(/{{path}}/g,h),"/"!=h&&(k+='<a href="../">../</a>\n'),fs.readdir(i,function(b,e){if(b)return g();var h="";e.forEach(function(b){if(!a.exclude||!a.exclude.test(b)){var c,e,f=fs.statSync(i+"/"+b),g=new Date(f.mtime);f.isDirectory()?(e="-",c='<a href="'+b+'/">'+b+"</a>"):(e=String(f.size),c='<a href="'+b+'">'+b+"</a>"),c+=multiple(b.length,50),a.date&&(c+=pad(g.getDate())+"-"+d[g.getMonth()]+"-"+g.getFullYear(),c+=" "+pad(g.getHours())+":"+pad(g.getMinutes()),c+=multiple(e.length,20)),a.size&&(c+=e),c+="\n",a.priority?"-"==e?k+=c:h+=c:k+=c}}),k+=h,f.send(k+c)})})}}try{var fs=require("fs"),resolve=require("path").resolve,url=require("url").parse}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a,b){if(!a)throw new TypeError("root path required");if(!fs.existsSync(a))throw new Error("path not exists");if(!fs.lstatSync(a).isDirectory())throw new Error("path is not a directory");if("/"==a[a.length-1])var a=a.substr(0,a.length-1);var b=b||Object.create(null),c={root:a,exclude:b.exclude||!1,date:0==b.date?!1:!0,size:0==b.size?!1:!0,priority:0==b.priority?!1:!0};return wrapper(c)};
