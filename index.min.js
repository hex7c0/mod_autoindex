/*
 * mod_autoindex v0.0.1
 * (c) hex7c0 http://supergiovane.tk/#/mod_autoindex
 * Licensed under GPLv3
 */
"use strict";function multiple(a,b){var c="";if(a>b)return c;for(var d=0;b-a>d;d++)c+=" ";return c}function wrapper(a){var b='<html>\n<head><title>Index of {{path}}</title></head>\n<body bgcolor="white">\n<h1>Index of {{path}}</h1><hr><pre>\n',c="</pre><hr></body>\n</html>\n";return function(d,e,f){var g=b,h=url(d.originalUrl||d.url).pathname,i=a+h;fs.stat(i,function(a,b){return a?f():b.isDirectory()?(g=g.replace(/{{path}}/g,h),"/"!=h&&(g+='<a href="../">../</a>\n'),void fs.readdir(i,function(a,b){return a?f():(b.forEach(function(a){var b,c=fs.statSync(i+"/"+a);c.isDirectory()?(b="-",g+='<a href="'+a+'/">'+a+"</a>"):(b=String(c.size),g+='<a href="'+a+'">'+a+"</a>"),g+=multiple(a.length,50),g+=new Date(c.mtime).toUTCString(),g+=multiple(b.length,20),g+=b+"\n"}),void e.send(g+c))})):f()})}}try{var fs=require("fs"),resolve=require("path").resolve,url=require("url").parse}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){if(!a)throw new TypeError("root path required");if(!fs.existsSync(a))throw new Error("path not exists");if(!fs.lstatSync(a).isDirectory())throw new Error("path is not a directory");if("/"==a[a.length-1])var a=a.substr(0,a.length-1);return wrapper(a)};
