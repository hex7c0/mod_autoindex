"use strict";function multiple(a,b){var c="";if(a>b)return c;for(var d=0,e=b-a;e>d;d++)c+=" ";return c}function error(a){return new Error(isNaN(a)===!1?STATUS[a]:"ENAMETOOLONG"===a.code?STATUS[414]:STATUS[404])}function pad(a){var b=Math.abs(Math.floor(a));return(10>b?"0":"")+b}function wrapper(a){function b(b,c,d,f,g){a.json===!0?(b.send(c),e.body=c):(c+=d+footer,b.send(c),e.body=c),a.cache===!0&&(e.path=f,e.mtime=g.mtime.getTime())}function c(b,c,d,e){var f,g=d;if(e.isDirectory()===!0?(f="-",g+="/"):f=String(e.size),b[g]=Object.create(null),a.date===!0){var h=new Date(e.mtime),i=pad(h.getDate())+"-"+month[h.getMonth()]+"-"+h.getFullYear();i+=" "+pad(h.getHours())+":"+pad(h.getMinutes()),b[g].mtime=i}return a.size===!0&&(b[g].size=f),[b,null]}function d(b,c,d,e){var f,g,h=b,i=c,j=d;if(e.isDirectory()===!0?(g="-",j+="/"):g=String(e.size),f='<a href="'+j+'">'+j+"</a>",f+=multiple(j.length,50),a.date===!0){var k=new Date(e.mtime);f+=pad(k.getDate())+"-"+month[k.getMonth()]+"-"+k.getFullYear(),f+=" "+pad(k.getHours())+":"+pad(k.getMinutes()),f+=multiple(g.length,20)}return a.size===!0&&(f+=g),f+="\n",a.priority===!0?"-"===g?h+=f:i+=f:h+=f,[h,i]}var e=Object.create(null),f=d;return a.json===!0&&(f=c),a.sync===!0?function(c,d,g){if(a.strictMethod===!0&&"GET"!==c.method&&"HEAD"!==c.method)return g(error(404));var h=decodeURIComponent(parse(c).pathname).replace(/\/{2,}/,"/"),i=normalize(join(a.root,h));if(~i.indexOf("\x00"))return g(error(400));if(i<=a.root)return g(error(403));var j=fs.statSync(i);if(void 0!==j){if(void 0!==e.mtime&&e.mtime===j.mtime.getTime()&&e.path===i)return d.send(e.body);if(j.isDirectory()===!1)return a.statico(c,d,g);var k;a.json===!0?k=Object.create(null):(k=header,k=k.replace(/{{path}}/g,h),"/"!=h&&(k+='<a href="../">../</a>\n'));var l=fs.readdirSync(i);if(void 0!==l){for(var m="",n=0,o=l.length;o>n;n++){var p=l[n];if(!(a.exclude!==!1&&a.exclude.test(p)||a.dotfiles===!0&&"."===p[0])){var q=fs.statSync(i+PATH.sep+p);if(void 0!==q){var r=f(k,m,p,q);k=r[0],m=r[1]}}}return b(d,k,m,i,j)}}return a.statico(c,d,g)}:function(c,d,g){if(a.strictMethod===!0&&"GET"!==c.method&&"HEAD"!==c.method)return g(error(404));var h=decodeURIComponent(parse(c).pathname).replace(/\/{2,}/,"/"),i=normalize(join(a.root,h));return~i.indexOf("\x00")?g(error(400)):i<=a.root?g(error(403)):void fs.stat(i,function(j,k){if(null!==j)return g(error(j));if(e.mtime&&e.mtime===k.mtime.getTime()&&e.path===i)return d.send(e.body);if(k.isDirectory()===!1)return a.statico(c,d,g);var l;a.json===!0?l=Object.create(null):(l=header,l=l.replace(/{{path}}/g,h),"/"!=h&&(l+='<a href="../">../</a>\n')),fs.readdir(i,function(c,e){if(null!==c)return g(error(c));for(var h="",j=e.length-1,m=0,n=e.length;n>m;m++)!function(c){return a.exclude!==!1&&a.exclude.test(c)?0===j?b(d,l,h,i,k):void j--:a.dotfiles===!0&&"."===c[0]?0===j?b(d,l,h,i,k):void j--:void fs.stat(i+PATH.sep+c,function(a,e){if(null!==a)return g(error(a));var m=f(l,h,c,e);return l=m[0],h=m[1],0===j?b(d,l,h,i,k):void j--})}(e[m])})})}}function index(a,b){if(!a)throw new TypeError("root path required");var c=resolve(a);if("/"==c[c.length-1]&&(c=c.substr(0,c.length-1)),!fs.existsSync(a))throw new Error("path not exists");if(!fs.statSync(c).isDirectory())throw new Error("path is not a directory");var d=b||Object.create(null),e={root:c,exclude:d.exclude||!1,dotfiles:d.dotfiles===!1?!1:!0,date:d.date===!1?!1:!0,size:d.size===!1?!1:!0,priority:d.priority===!1?!1:!0,cache:d.cache===!1?!1:!0,strictMethod:Boolean(d.strictMethod),sync:Boolean(d.sync),json:Boolean(d.json),statico:d.static===!1?function(a,b,c){return c()}:serve(c,d.static)};return wrapper(e)}try{var STATUS=require("http").STATUS_CODES,PATH=require("path"),fs=require("fs"),normalize=PATH.normalize,resolve=PATH.resolve,join=PATH.join,parse=require("parseurl"),serve=require("serve-static")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}var header='<html>\n<head><title>Index of {{path}}</title></head>\n<body bgcolor="white">\n<h1>Index of {{path}}</h1><hr><pre>\n',footer="</pre><hr></body>\n</html>\n",month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];module.exports=index;
